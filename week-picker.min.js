!function(t,e){"use strict";if("function"==typeof define&&define.amd)define(["jquery","moment"],e);else{var n=t.jQuery,i=t.moment;if(!n)throw new Error("WeekPicker requires jQuery to be loaded first!");if(!i)throw new Error("WeekPicker requires moment.js to be loaded first!");e(n,i)}}(this,function(t,e){function n(t){return t.startOf("day")}function i(t,e,n){for(var i=[],o=!1,a=t.clone(),r=a.month(),h=0;!o;)i.push({number:a.week(),days:s(a.clone(),n),current:a.week()===e}),a.add(1,"week"),o=h++>2&&r!==a.month(),r=a.month();return i}function s(t,e){for(var n=[],i=new Date,s=0;7>s;s++)n.push({number:t.date(),prevMonth:t.month()<e,nextMonth:t.month()>e,isToday:t.isSame(i,"day"),date:t}),t=t.clone().add(1,"day");return n}function o(e,n){this.$el=t(e),this.$el.data("weekpicker",this),this.options=t.extend({},r,n),this._rendered=!1,this._init()}var a=["Lu","Ma","Me","Je","Ve","Sa","Di"],r={initialDate:e(),valueFormat:null,endDate:null,onChange:null,showWeekNumber:!1};return o.prototype={_init:function(){this.proxy("show").proxy("hide").proxy("_prev").proxy("_next"),this._initialDate=n(this.options.initialDate||e()),this._currentWeek=this._initialDate.week(),this._currentYear=this._initialDate.year(),this._monthDate=this._initialDate.clone(),this._endDate=this.options.endDate?this.options.endDate.isoWeek():null,this._setDate(this._initialDate),this.options.endDate&&(this._endDate=this.options.endDate.startOf("isoWeek"),this._endDate=this._endDate.unix()),this._renderFrame(),this._attachEvents()},_setDate:function(t){t=n(t.clone().date(1).startOf("isoWeek")),this._currentDate=t,this._currentMonth=this._monthDate.month()},_renderFrame:function(){var e=t("<div>").addClass("prev").text("‹"),n=t("<div>").addClass("next").text("›"),i=t("<span>").addClass("title"),s=t("<div>").addClass("controls").append(e,i,n),o=t("<div>").addClass("weekpicker-days");this.$picker=t("<div>").addClass("weekpicker dropdown-menu").append(s,o).insertAfter(this.$el),this.$title=i,this.$days=o},_attachEvents:function(){var e=this;e.$el.on("focus",t.proxy(e.show,e)).on("click",t.proxy(e.show,e)).on("change",t.proxy(e.selectWeek,e)),e.$picker.on("click",function(t){t.stopPropagation()}).on("mousedown",function(t){t.stopPropagation()}).on("click",".controls .prev",e._prev).on("click",".controls .next",e._next).on("click",".weekpicker-days tr",function(){e._select(t(this))})},_renderMonth:function(){var e,n,s,o,r,h=i(this._currentDate,this._currentWeek,this._currentMonth,this._endDate),d=t("<table>").addClass("table-condensed");o=t("<tr>"),this.options.showWeekNumber&&o.append(t("<th>").text("S"));for(var c=0;7>c;c++)o.append(t("<th>").text(a[c]));d.append(o);for(var l=0,u=h.length;u>l;l++){o=t("<tr>"),e=h[l],n=e.days,o.addClass("week-"+e.number).addClass(e.disabled?"disabled":"enabled"),e.current&&o.addClass("selected"),o.data("days",n),this.options.showWeekNumber&&o.append(t("<td>").text(e.number));for(var p=0,_=n.length;_>p;p++)s=n[p],r=t("<td>").text(s.number),s.prevMonth&&r.addClass("prev"),s.nextMonth&&r.addClass("next"),s.isToday&&r.addClass("today"),o.append(r);d.append(o)}this.$days.html(d),this.$title.text(this._monthDate.format("MMMM YYYY")),this._rendered=!0},_prev:function(){var t=this._monthDate.clone();this._monthDate.month(this._monthDate.month()-1),this._setDate(t.month(t.month()-1)),this._renderMonth()},_next:function(){var t=this._monthDate.clone();this._monthDate.month(this._monthDate.month()+1),this._setDate(t.month(t.month()+1)),this._renderMonth()},_select:function(t){var e,n,i=t.data("days");!t.hasClass("disabled")&&i&&(e=i[0].date,n=i[6].date,this._currentDate=e,this._currentWeek=e.week(),this._currentYear=e.year(),this._renderMonth(),this.$el.is("input")&&(this.options.valueFormat instanceof Function?this.$el.val(this.options.valueFormat.apply(this,[e,n])):this.$el.val(e.format("DD/MM/YYYY")+" - "+n.format("DD/MM/YYYY"))),this.options.onChange instanceof Function&&this.options.onChange({start:e,end:n}),this.$el.trigger("change",[e,n,this]),this.hide())},proxy:function(e){return this[e]=t.proxy(this[e],this),this},show:function(e){e&&e.stopPropagation(),this._renderMonth();var n=this.$el.position();this.$picker.css({top:n.top+this.$el.outerHeight()+2,left:n.left}).show(),t("body").one("click",this.hide)},hide:function(){this.$picker.hide()},date:function(){return this._currentDate.clone()},week:function(){return this._currentWeek},year:function(){return this._currentYear}},t.fn.weekpicker=function(t){return this.each(function(){new o(this,t)})},o});